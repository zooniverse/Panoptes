require 'spec_helper'

RSpec.describe TasksVisitors::ExtractStrings do
  let(:task_hash) do
    {
     interest: {
                type: 'drawing',
                question: 'Color some points',
                help: "Stuff",
                tools: [
                        {value: 'red', label: 'Red', type: 'point', color: 'red'},
                        {value: 'green', label: 'Green', type: 'point', color: 'lime'},
                        {value: 'blue', label: 'Blue', type: 'point', color: 'blue'}
                       ],
                next: 'shape'
               },
     shape: {
             type: 'multiple',
             question: 'What shape is this galaxy?',
             answers: [
                       {value: 'smooth', label: 'Smooth'},
                       {value: 'features', label: 'Features'},
                       {value: 'other', label: 'Star or artifact'}
                      ],
             required: true,
             next: 'roundness'
            },
     roundness: {
                 type: 'single',
                 question: 'How round is it?',
                 answers: [
                           {value: 'very', label: 'Very...', next: 'shape'},
                           {value: 'sorta', label: 'In between'},
                           {value: 'not', label: 'Cigar shaped'}
                          ],
                 next: nil
                },
     "location" => {
                    "type" => "marking",
                    "instruction" => "Mark any stray ghost particles or slime bubbles you can see.",
                    "features" => [
                                   {
                                    "shape" => "point",
                                    "value" => "particle",
                                    "label" => "Ghost particle",
                                    "color" => "pink"
                                   },
                                   {
                                    "shape" => "ellipse",
                                    "value" => "bubble",
                                    "label" => "Slime bubble",
                                    "color" => "lime"
                                   }
                                  ],
                    "next" => nil
                   }
    }
  end

  describe "#visit" do
    context "given an hash collector" do
      let(:collector) { {} }
      subject do
        TasksVisitors::ExtractStrings.new(collector)
      end

      before(:each) do
        subject.visit(task_hash)
      end

      it 'should substitute question strings with TaskIndex objects' do
        question_vals = task_hash.values_at(:interest, :shape, :roundness)
          .map { |hash| hash[:question] }
        expect(question_vals).to include("interest.question",
                                         "shape.question",
                                         "roundness.question")
      end

      it 'should substitute label strings with TaskIndex objects' do
        label_vals = task_hash.values_at(:interest, :shape, :roundness)
          .flat_map do |hash|
            key = hash.has_key?(:answers) ? :answers : :tools
            hash[key].map { |h| h[:label] }
          end

        expect(label_vals).to include("interest.tools.0.label",
                                      "shape.answers.0.label",
                                      "roundness.answers.0.label")
      end

      it 'should set the key to the path of the substituted string' do
        expect(task_hash[:interest][:question]).to eq("interest.question")
      end

      it 'should substitute help strings with TaskIndex objects' do
        help_vals = task_hash.values_at(:interest, :shape, :roundness)
          .map { |hash| hash[:help] }
        expect(help_vals).to include('interest.help')
      end

      it 'should populate the collector with strings' do
        expect(collector).to include("interest.question" => "Color some points",
                                     "interest.tools.0.label" => 'Red',
                                     "roundness.question" => 'How round is it?',
                                     "roundness.answers.2.label" => "Cigar shaped")
      end
    end

    context "without an hash collector" do
      it 'should return the strings via the collect method' do
        subject.visit(task_hash)
        expect(subject.collector).to include("interest.question" => "Color some points",
                                             "interest.tools.0.label" => 'Red',
                                             "roundness.question" => 'How round is it?',
                                             "roundness.answers.2.label" => "Cigar shaped")
      end
    end

    context "with a survey task", :focus do
      let(:survey_task_hash) do
        {"T1"=>{"type"=>"survey", "images"=>{"fire-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/02f6943f-db24-4770-a143-4319733a4c81.jpeg", "hare-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/1a545e0c-7b08-426b-bc4f-eb7efd71270e.jpeg", "hare-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/1eb4df00-9b12-4307-8adb-35f65b541e86.jpeg", "hare-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/8ccdd6f4-9fca-4c0c-ad71-88516019cc6f.jpeg", "kudu-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/8e20e7ae-1e9a-4b67-b2d9-58791d9ee13a.jpeg", "kudu-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/c0d7bf3f-853f-4a4e-b551-d9750438a5ed.jpeg", "kudu-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/6b83e1eb-b7c8-4e22-bbaa-2e51e86b8fe6.jpeg", "civet-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/2fbdbb24-a345-4bec-a53b-64cca54e5adf.jpeg", "civet-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/eb10cdfa-5603-48b3-be6e-3cf832e3ee9f.jpeg", "civet-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/65d8e655-7298-405d-a0f7-ca63ed1bd0e0.jpeg", "crane-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/bd2587fa-3d6c-463e-ae3b-60337f0d73cf.jpeg", "crane-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/39247e42-965b-4f6e-b5f3-19e312c84ced.jpeg", "crane-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/270841a1-0072-4658-98ef-2d818f78a4cc.jpeg", "eland-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/6a004cee-5c16-4095-a7e6-d2f79a5046f5.jpeg", "eland-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/b2a5de40-55b9-4d1e-97c5-bcc15d0eb8aa.jpeg", "eland-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/f54c77fb-166b-4f6d-8e8e-dd6ebb6d744d.jpeg", "empty-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/17227a85-7fee-4e92-9875-4ea8360b2dbb.jpeg", "genet-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/f9ce01b9-bc87-4399-b249-8e240b6dea7d.jpeg", "genet-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/2f59c3af-9aeb-4aef-bee2-98d37db21134.jpeg", "genet-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/a7fc5a74-a5ea-472d-88bd-c4e879a1f284.jpeg", "hippo-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/ab0c47e4-ec80-4d0e-a29f-dd4ef362ec5f.jpeg", "hippo-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/51d94fb5-8561-441b-84da-c386a43a51be.jpeg", "hippo-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/c11cc839-d5cc-4626-9c12-5f0387e9c412.jpeg", "human-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/82041c7a-f630-472f-b6d9-871e7e0eb36e.jpeg", "human-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/bcc37483-b2f2-4bf8-b7a3-615445becdf4.jpeg", "human-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/46f2c1d5-6acc-4c2a-8ba8-95960cbd8bc2.jpeg", "hyena-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/de3a94a8-82fb-463a-8c26-fe3648be998a.jpeg", "hyena-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/54e02b52-c6b3-45bc-8f1e-d68eee646c00.jpeg", "hyena-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/73e86cd6-768f-49c9-b55e-23de58777fff.jpeg", "baboon-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/1871e00c-a625-404e-82d9-49a56584b78e.jpeg", "baboon-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/a16952c4-d8c9-41a8-879b-377d9116ccc9.jpeg", "baboon-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/edb19b1c-8334-4fc3-a84b-3361bb66fb9e.jpeg", "duiker-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/0dacb941-d314-4dd3-abde-4a96b4502524.jpeg", "duiker-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/93d4eec0-3ad3-43a8-a341-81609adbdf71.jpeg", "duiker-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/f0c6854e-1518-4752-ba33-9f22affea7aa.jpeg", "impala-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/61577194-a1b8-49bf-b813-1c9607c7dd89.jpeg", "impala-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/cd50bc1c-ee4d-46b0-b573-5c87f13e784a.jpeg", "impala-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/745efb41-d87e-4486-a712-b2da9142f406.jpeg", "jackal-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/75a738a6-5f29-40fe-b632-e0dce79c7616.jpeg", "jackal-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/5898dfea-b1a0-4b57-9ecd-cf5440c3b9d3.jpeg", "jackal-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/b35ea704-10af-4fea-87ee-da9fb308524a.jpeg", "buffalo-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/245f9638-fbc0-460a-9199-1d40605eab63.jpeg", "buffalo-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/78bf6311-b57b-4f5b-a3a4-c4cec8123943.jpeg", "buffalo-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/4a8f5f87-093b-4e62-a055-8f05e6755bb0.jpeg", "bushpig-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/c2bde657-6653-4402-af65-55d547110f67.jpeg", "bushpig-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/f3f7848b-04b0-4098-9e50-3207cd0b9727.jpeg", "bushpig-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/c8529a60-11b0-49b0-9d3b-4fd38418dd2e.jpeg", "caracal-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/3242e0d0-ecb4-4240-8eda-82a48734d39b.jpeg", "caracal-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/7276a2cc-e268-4ac7-8b1b-c4b221aab124.jpeg", "caracal-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/c52796d6-cb1e-44c9-99e9-2457a0978bff.jpeg", "aardvark-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/362d0a60-84a1-41db-9ea9-a42789f492c8.jpeg", "aardvark-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/032d783f-6ca4-4b1d-996d-c64454622bb8.jpeg", "aardvark-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/2e4c6e80-7358-4cff-8332-fa348e10c3e6.jpeg", "bushbuck-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/20f52791-d698-4df4-ac78-da491c0d35ab.jpeg", "bushbuck-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/b3f8956b-1c41-4323-b8c2-eb923be670cb.jpeg", "bushbuck-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/4dcc5484-e869-4591-aa99-62632d015cc3.jpeg", "elephant-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/a5005fbd-cd22-4619-8993-f2f314a1f739.jpeg", "elephant-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/193d7ca5-d083-476d-a4ac-8fbd2b6629e9.jpeg", "elephant-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/81a41904-9dee-4ea7-8c9d-e154dcd8233e.jpeg", "birdother-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/54aee2cf-efdc-40f4-9541-322888fb0e4c.jpeg", "birdother-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/a8f2dbb1-2048-4e7f-b602-a9c82f3b4bd2.jpeg", "birdother-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/4786c3b8-8174-4fde-a51f-7123d5a29079.jpeg", "hartebeest-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/789e5a0e-1277-4c43-9e64-25eed5123c00.jpeg", "hartebeest-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/97996139-0d5f-4e78-b9cf-bf469b330834.jpeg", "hartebeest-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/faafd937-df76-4ee9-ab16-7dc53d9a9e20.jpeg", "honeybadger-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/f192b375-9f1a-461a-902e-798cb1ce61bc.jpeg", "honeybadger-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/1a3aa1be-f73c-40c9-830a-f35bb552c107.jpeg", "honeybadger-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/6ae28815-64f4-443c-9deb-498400a12d74.jpeg", "groundhornbill-1.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/e011e135-9242-49c1-aa21-fc02e108a994.jpeg", "groundhornbill-2.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/42deb4aa-f72b-4a2f-a0fb-913389b7ff39.jpeg", "groundhornbill-3.jpg"=>"https://panoptes-uploads.zooniverse.org/staging/workflow_attached_image/335b904d-d57f-47c1-91bf-df4ea9dadd4a.jpeg"}, "choices"=>{"FR"=>{"label"=>"Fire", "images"=>["fire-1.jpg"], "confusions"=>{}, "description"=>"It's a fire. Pretty sure you know what this looks like.", "noQuestions"=>true, "characteristics"=>{"LK"=>[], "TL"=>[], "BLD"=>[], "CLR"=>[], "HRNS"=>[], "PTTRN"=>[]}, "confusionsOrder"=>[]}, "HN"=>{"label"=>"Hyena", "images"=>["hyena-1.jpg", "hyena-2.jpg", "hyena-3.jpg"], "confusions"=>{}, "description"=>"Big ugly puppies with no discipline that eat all my camera traps.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG"], "TL"=>["BSH"], "BLD"=>["STCK", "LNK"], "CLR"=>["TNLLW", "BRWN", "BLCK"], "HRNS"=>[], "PTTRN"=>["SPTS"]}, "confusionsOrder"=>[]}, "HR"=>{"label"=>"Hare", "images"=>["hare-1.jpg", "hare-2.jpg", "hare-3.jpg"], "confusions"=>{}, "description"=>"Large rabbitlike animal with very long ears. There are two hare species in Gorongosa. The savanna hare has gray fur with a lighter brown underbelly, while the scrub hare is darker gray and has a white underbelly.", "noQuestions"=>false, "characteristics"=>{"LK"=>["THR"], "TL"=>["BSH", "SHRT"], "BLD"=>["SMLL", "LWSLNG"], "CLR"=>["TNLLW", "BRWN", "WHT", "GR"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "KD"=>{"label"=>"Kudu", "images"=>["kudu-1.jpg", "kudu-2.jpg", "kudu-3.jpg"], "confusions"=>{"LND"=>"An eland is more stocky and ox-like than a kudu with long, straight horns that twist. It has a dewlap below the neck.", "HRTBST"=>"Kudus are stripey and way prettier than hartebeest."}, "description"=>"Large, lanky antelope with long legs, a short mane along the neck and shoulders, a brownish-gray to tan coat with vertical white stripes along the torso, a white chevron between the eyes, and large round ears. Males have a beard along the throat and massive spiral horns. Females are have no horns", "noQuestions"=>false, "characteristics"=>{"LK"=>["CWHRS", "NTLPDR"], "TL"=>["BSH", "SHRT"], "BLD"=>["STCK", "LNK", "LRG"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT", "GR"], "HRNS"=>["CRVD", "SPRL"], "PTTRN"=>["SLD", "STRPS"]}, "confusionsOrder"=>["LND", "HRTBST"]}, "BBN"=>{"label"=>"Baboon", "images"=>["baboon-1.jpg", "baboon-2.jpg", "baboon-3.jpg"], "confusions"=>{}, "description"=>"AKA the creatures that break into your house and destroy everything.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG", "PRMT", "THR"], "TL"=>["SMTH", "LNG"], "BLD"=>["LNK", "SMLL"], "CLR"=>["TNLLW", "BRWN", "GR"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "CRN"=>{"label"=>"Crane", "images"=>["crane-1.jpg", "crane-2.jpg", "crane-3.jpg"], "confusions"=>{}, "description"=>"Long-legged, long-necked bird with a straight beak. There are two crane species in Gorongosa: the grey crowned crane and the wattled crane. The gray-crowned crane has gray, white, and yellow feathers with a distinctive yellow fan of feathers on its head. The wattled crane has gray, black, and white feathers with red skin around its yellow beak.", "noQuestions"=>false, "characteristics"=>{"LK"=>["BRD"], "TL"=>["SMTH", "LNG"], "BLD"=>["LNK"], "CLR"=>["TNLLW", "WHT", "GR", "BLCK"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "CVT"=>{"label"=>"Civet", "images"=>["civet-1.jpg", "civet-2.jpg", "civet-3.jpg"], "confusions"=>{"GNT"=>"Okay these two actually are confusing, but genets are cuter and more weasel/cat like."}, "description"=>"Long, stocky mammal with short legs and a pointy face. Fur is light brown-gray with a dark mask, white at the tip of the muzzle, dark legs, spots, and bands along the neck.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG", "WSL"], "TL"=>["SMTH", "BSH", "LNG", "SHRT"], "BLD"=>["SMLL", "LWSLNG"], "CLR"=>["TNLLW", "BRWN", "WHT", "GR", "BLCK"], "HRNS"=>[], "PTTRN"=>["STRPS", "BNDS", "SPTS"]}, "confusionsOrder"=>["GNT"]}, "DKR"=>{"label"=>"Duiker", "images"=>["duiker-1.jpg", "duiker-2.jpg", "duiker-3.jpg"], "confusions"=>{}, "description"=>"Duikers are small, deerlike antelope with a thin, short tail and colors ranging from blue-gray to red depending on the species. Males have short, straight horns. There are three species of duiker in Gorongosa: red, common, and blue duiker.", "noQuestions"=>false, "characteristics"=>{"LK"=>["NTLPDR"], "TL"=>["BSH", "SHRT"], "BLD"=>["LNK", "SMLL"], "CLR"=>["TNLLW", "RD", "BRWN", "GR"], "HRNS"=>["STRGHT"], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "GNT"=>{"label"=>"Genet", "images"=>["genet-1.jpg", "genet-2.jpg", "genet-3.jpg"], "confusions"=>{"CVT"=>"A civet is stockier than a genet with a much shorter tail and a dark mask on the face."}, "description"=>"Small, slender animal with tan-gray fur, large, ringed spots, a long, thick, black-ringed tail, and a white underbelly. It has a black stripe down the spine and a pointy muzzle.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG", "WSL"], "TL"=>["SMTH", "BSH", "LNG"], "BLD"=>["SMLL", "LWSLNG"], "CLR"=>["BRWN", "GR", "BLCK"], "HRNS"=>[], "PTTRN"=>["STRPS", "BNDS", "SPTS"]}, "confusionsOrder"=>["CVT"]}, "HMN"=>{"label"=>"Human", "images"=>["human-1.jpg"], "confusions"=>{}, "description"=>"Probably a researcher. Or not. Who knows!", "noQuestions"=>false, "characteristics"=>{"LK"=>[], "TL"=>[], "BLD"=>["TLLBLDTLLSVG", "LNKBLDLNKSVG"], "CLR"=>["TNCTTNLLWSVG", "RDCTRDBRWNSVG", "BRWNCTBRWNBLCKSVG", "WHTCTSLDSVG", "GRCTGRBLCKSVG", "BLCKCTGRBLCKSVG"], "HRNS"=>[], "PTTRN"=>["BNDSCTBNDSRSTRPSPNG", "SPTSCTSPTSPNG", "SLDCTSLDSVG"]}, "confusionsOrder"=>[]}, "LND"=>{"label"=>"Eland", "images"=>["eland-1.jpg", "eland-2.jpg", "eland-3.jpg"], "confusions"=>{"KD"=>"A kudu is taller and less ox-like than an eland, it has massive spiral horns and lacks a dewlap on the throat.", "HRTBST"=>"A hartebeest is a taller and more slender than an eland with reddish fur, narrow face, and short, spiral horns."}, "description"=>"Massive antelope with an oxlike body and short legs. Both sexes have straight, spiraled horns, a short mane, and a smooth light tan to gray coat with thin white stripes on the sides. Males have a large dewlap under the throat.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CWHRS", "NTLPDR"], "TL"=>["TFTD", "LNG"], "BLD"=>["STCK", "LRG"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT", "GR"], "HRNS"=>["STRGHT", "SPRL"], "PTTRN"=>["SLD", "STRPS"]}, "confusionsOrder"=>["HRTBST", "KD"]}, "MPL"=>{"label"=>"Impala", "images"=>["impala-1.jpg", "impala-2.jpg", "impala-3.jpg"], "confusions"=>{"BSHBCK"=>"A bushbuck has vertical white stripes and spots on the flanks as well as a rounded back."}, "description"=>"Medium-sized antelope with reddish-brown fur, white stripes around the eyes, and black stripes on the forehead and tail. Coat forms horizontal bands of red fur along the back, tan fur along the sides, and white fur on the underbelly. Males have large horns.", "noQuestions"=>false, "characteristics"=>{"LK"=>["NTLPDR"], "TL"=>["BSH", "SHRT"], "BLD"=>["LNK", "LRG"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT", "BLCK"], "HRNS"=>["STRGHT", "CRVD", "SPRL"], "PTTRN"=>["SLD", "BNDS"]}, "confusionsOrder"=>["BSHBCK"]}, "BFFL"=>{"label"=>"Buffalo", "images"=>["buffalo-1.jpg", "buffalo-2.jpg", "buffalo-3.jpg"], "confusions"=>{}, "description"=>"Large, cattlelike animal with short legs and a long, tufted tail, dark brown to black fur, large, droopy ears, and a broad muzzle. Both sexes have U-shaped horns, but males� horns form a fused shield on the top of their heads.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CWHRS"], "TL"=>["TFTD", "LNG"], "BLD"=>["STCK", "LRG"], "CLR"=>["RD", "BRWN", "GR", "BLCK"], "HRNS"=>["CRVD", "SHPD"], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "CRCL"=>{"label"=>"Caracal", "images"=>["caracal-1.jpg", "caracal-2.jpg", "caracal-3.jpg"], "confusions"=>{"CVT"=>"Caracals look like cats with makeup. Civets have spots. They look nothing alike."}, "description"=>"Gorgeous cats that look like they are wearing makeup.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG"], "TL"=>["SMTH", "LNG"], "BLD"=>["LNK", "LRG"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>["CVT"]}, "JCKL"=>{"label"=>"Jackal", "images"=>["jackal-1.jpg", "jackal-2.jpg", "jackal-3.jpg"], "confusions"=>{}, "description"=>"Medium-sized, gray-brown, doglike animal with a pointy face and ears. It has tan legs and underbelly with a black and white striped side, a gray back, and a long, bushy black tail with a white tip.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG"], "TL"=>["BSH", "LNG"], "BLD"=>["LNK", "SMLL"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT", "GR", "BLCK"], "HRNS"=>[], "PTTRN"=>["SLD", "BNDS"]}, "confusionsOrder"=>[]}, "BSHPG"=>{"label"=>"Bushpig", "images"=>["bushpig-1.jpg", "bushpig-2.jpg", "bushpig-3.jpg"], "confusions"=>{}, "description"=>"Squat, flat-nosed, and piglike with long ears and reddish-brown fur with silver running down the spine. Both sexes have short, inconspicuous tusks.", "noQuestions"=>false, "characteristics"=>{"LK"=>["THR"], "TL"=>["TFTD"], "BLD"=>["STCK", "SMLL", "LWSLNG"], "CLR"=>["RD", "BRWN"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "LPHNT"=>{"label"=>"Elephant", "images"=>["elephant-1.jpg", "elephant-2.jpg", "elephant-3.jpg"], "confusions"=>{}, "description"=>"Huge, leathery, gray-skinned mammal with large, floppy ears and thick, strong legs. It has a short, tufted tail and a long, thick trunk. Some elephants of both sexes have large, white tusks, but some individuals never develop tusks or develop only one tusk.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CWHRS", "THR"], "TL"=>["TFTD"], "BLD"=>["STCK", "LRG"], "CLR"=>["GR"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "RDVRK"=>{"label"=>"Aardvark", "images"=>["aardvark-1.jpg", "aardvark-2.jpg", "aardvark-3.jpg"], "confusions"=>{"FR"=>"You probably shouldn't be getting these confused."}, "description"=>"Not as awesome as a pangolin, but surprisingly big.", "noQuestions"=>false, "characteristics"=>{"LK"=>["WSL", "THR"], "TL"=>["SMTH", "LNG"], "BLD"=>["STCK", "SMLL"], "CLR"=>["RD", "BRWN", "GR"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>["FR"]}, "BRDTHR"=>{"label"=>"Bird (other)", "images"=>["birdother-1.jpg", "birdother-2.jpg", "birdother-3.jpg"], "confusions"=>{}, "description"=>"There are a lot of these.", "noQuestions"=>false, "characteristics"=>{"LK"=>["BRD"], "TL"=>["SMTH", "LNG", "SHRT"], "BLD"=>["SMLL"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT", "GR", "BLCK"], "HRNS"=>[], "PTTRN"=>["SLD", "STRPS", "BNDS", "SPTS"]}, "confusionsOrder"=>[]}, "BSHBCK"=>{"label"=>"Bushbuck", "images"=>["bushbuck-1.jpg", "bushbuck-2.jpg", "bushbuck-3.jpg"], "confusions"=>{}, "description"=>"Look like they belong someplace much colder than the Serengeti.", "noQuestions"=>false, "characteristics"=>{"LK"=>["NTLPDR"], "TL"=>["BSH", "SHRT"], "BLD"=>["LNK", "LRG"], "CLR"=>["TNLLW", "RD", "BRWN", "WHT"], "HRNS"=>["STRGHT", "CRVD"], "PTTRN"=>["STRPS", "SPTS"]}, "confusionsOrder"=>[]}, "HNBDGR"=>{"label"=>"Honey Badger", "images"=>["honeybadger-1.jpg", "honeybadger-2.jpg", "honeybadger-3.jpg"], "confusions"=>{}, "description"=>"Randall has something to say about these guys.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CTDG", "WSL"], "TL"=>["BSH"], "BLD"=>["STCK", "SMLL", "LWSLNG"], "CLR"=>["WHT", "GR", "BLCK"], "HRNS"=>[], "PTTRN"=>["SLD", "BNDS"]}, "confusionsOrder"=>[]}, "HRTBST"=>{"label"=>"Hartebeest", "images"=>["hartebeest-1.jpg", "hartebeest-2.jpg", "hartebeest-3.jpg"], "confusions"=>{"KD"=>"Kudus are stripey and way prettier than hartebeest.", "LND"=>"An eland is more stocky and ox-like than a hartebeest with long, straight horns that twist. It has a dewlap below the neck."}, "description"=>"Large, reddish-yellow antelope with an elongated, horselike face, large, pointy ears, humped shoulders, sloped back, and a light underbelly and hind parts with a short, tufted tail. Both sexes have curved, ridged horns.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CWHRS", "NTLPDR"], "TL"=>["TFTD", "LNG"], "BLD"=>["STCK", "LNK", "LRG"], "CLR"=>["TNLLW", "RD", "BRWN"], "HRNS"=>["CRVD", "SPRL"], "PTTRN"=>["SLD"]}, "confusionsOrder"=>["LND", "KD"]}, "HPPPTMS"=>{"label"=>"Hippopotamus", "images"=>["hippo-1.jpg", "hippo-2.jpg", "hippo-3.jpg"], "confusions"=>{}, "description"=>"Massive and low to the ground with short legs, small ears, gray to pink skin, a wide muzzle, and a short tail with a bristly tassel.", "noQuestions"=>false, "characteristics"=>{"LK"=>["CWHRS", "THR"], "TL"=>["SMTH", "SHRT"], "BLD"=>["STCK", "LRG", "LWSLNG"], "CLR"=>["RD", "BRWN", "GR"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}, "NTHNGHR"=>{"label"=>"Nothing here", "images"=>["empty-1.jpg"], "confusions"=>{}, "description"=>"Don't tell the plant biologists we called vegetation \"nothing here\"�", "noQuestions"=>true, "characteristics"=>{"LK"=>[], "TL"=>[], "BLD"=>[], "CLR"=>[], "HRNS"=>[], "PTTRN"=>[]}, "confusionsOrder"=>[]}, "GRNDHRNBLL"=>{"label"=>"Ground Hornbill", "images"=>["groundhornbill-1.jpg", "groundhornbill-2.jpg", "groundhornbill-3.jpg"], "confusions"=>{}, "description"=>"Large, stocky black bird with a red face, long, black beak, and red flaps of skin on its throat.", "noQuestions"=>false, "characteristics"=>{"LK"=>["BRD"], "TL"=>["SMTH"], "BLD"=>["STCK", "SMLL"], "CLR"=>["RD", "WHT", "BLCK"], "HRNS"=>[], "PTTRN"=>["SLD"]}, "confusionsOrder"=>[]}}, "questions"=>{"HWMN"=>{"label"=>"How many?", "answers"=>{"1"=>{"label"=>"1"}, "2"=>{"label"=>" 2"}, "3"=>{"label"=>" 3"}, "4"=>{"label"=>" 4"}, "5"=>{"label"=>" 5"}, "6"=>{"label"=>" 6"}, "7"=>{"label"=>" 7"}, "8"=>{"label"=>" 8"}, "9"=>{"label"=>" 9"}, "10"=>{"label"=>" 10"}, "51"=>{"label"=>" 51+"}, "1150"=>{"label"=>" 11-50"}}, "multiple"=>false, "required"=>true, "answersOrder"=>["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "1150", "51"]}, "DNTCR"=>{"label"=>"Don't care?", "answers"=>{"N"=>{"label"=>" No"}, "S"=>{"label"=>"Yes"}}, "multiple"=>false, "required"=>true, "answersOrder"=>["S", "N"]}, "DSNHRNS"=>{"label"=>"Do you see any horns?", "answers"=>{"N"=>{"label"=>" No"}, "S"=>{"label"=>"Yes"}}, "multiple"=>false, "required"=>false, "answersOrder"=>["S", "N"]}, "NGPRSNT"=>{"label"=>"Young present?", "answers"=>{"SN"=>{"label"=>"Yes, No"}}, "multiple"=>false, "required"=>true, "answersOrder"=>["SN"]}, "WHTBHVRSDS"=>{"label"=>"What behaviors do you see?", "answers"=>{"TNG"=>{"label"=>" Eating"}, "MVNG"=>{"label"=>" Moving"}, "RSTNG"=>{"label"=>"Resting"}, "STNDNG"=>{"label"=>" Standing"}, "NTRCTNG"=>{"label"=>" Interacting"}}, "multiple"=>true, "required"=>true, "answersOrder"=>["RSTNG", "STNDNG", "MVNG", "TNG", "NTRCTNG"]}, "RTHRNNGPRSNT"=>{"label"=>"Are there any young present?", "answers"=>{"N"=>{"label"=>" No"}, "S"=>{"label"=>"Yes"}}, "multiple"=>false, "required"=>false, "answersOrder"=>["S", "N"]}}, "choicesOrder"=>["RDVRK", "BBN", "BRDTHR", "BFFL", "BSHBCK", "BSHPG", "CRCL", "CVT", "CRN", "DKR", "LND", "LPHNT", "GNT", "GRNDHRNBLL", "HR", "HRTBST", "HPPPTMS", "HNBDGR", "HN", "MPL", "JCKL", "KD", "HMN", "FR", "NTHNGHR"], "questionsMap"=>{"HN"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "HR"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "KD"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT", "DSNHRNS"], "BBN"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "CRN"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "CVT"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "DKR"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "GNT"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "HMN"=>["WHTBHVRSDS", "RTHRNNGPRSNT"], "LND"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT", "DSNHRNS"], "MPL"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT", "DSNHRNS"], "BFFL"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "CRCL"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "JCKL"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "BSHPG"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "LPHNT"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "RDVRK"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "BRDTHR"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "BSHBCK"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "HNBDGR"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT", "DNTCR"], "HRTBST"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT", "DSNHRNS"], "HPPPTMS"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "GRNDHRNBLL"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"]}, "unlinkedTask"=>"T2", "questionsOrder"=>["HWMN", "WHTBHVRSDS", "RTHRNNGPRSNT"], "characteristics"=>{"LK"=>{"label"=>"Like", "values"=>{"BRD"=>{"image"=>"bird-icon.svg", "label"=>"bird"}, "THR"=>{"image"=>"nothing-icon.svg", "label"=>"other"}, "WSL"=>{"image"=>"weasel-icon.svg", "label"=>"weasel"}, "CTDG"=>{"image"=>"cat-dog-icon.svg", "label"=>"cat/dog"}, "PRMT"=>{"image"=>"primate-icon.svg", "label"=>"primate"}, "CWHRS"=>{"image"=>"cow-horse-icon.svg", "label"=>"cow/horse"}, "NTLPDR"=>{"image"=>"ante-deer-icon.svg", "label"=>"antelope/deer"}}, "valuesOrder"=>["CTDG", "CWHRS", "NTLPDR", "PRMT", "WSL", "BRD", "THR"]}, "TL"=>{"label"=>"Tail", "values"=>{"BSH"=>{"image"=>"bushy-icon.svg", "label"=>"bushy"}, "LNG"=>{"image"=>"long-icon.svg", "label"=>"long"}, "SHRT"=>{"image"=>"short-icon.svg", "label"=>"short"}, "SMTH"=>{"image"=>"smooth-icon.svg", "label"=>"smooth"}, "TFTD"=>{"image"=>"tafted-icon.svg", "label"=>"tufted"}}, "valuesOrder"=>["SMTH", "BSH", "TFTD", "LNG", "SHRT"]}, "BLD"=>{"label"=>"Build", "values"=>{"LNK"=>{"image"=>"lanky-icon.svg", "label"=>"lanky"}, "LRG"=>{"image"=>"large-icon.svg", "label"=>"large"}, "SMLL"=>{"image"=>"small-icon.svg", "label"=>"small"}, "STCK"=>{"image"=>"stocky-icon.svg", "label"=>"stocky"}, "LWSLNG"=>{"image"=>"lowslung-icon.svg", "label"=>"low-slung"}}, "valuesOrder"=>["STCK", "LNK", "LRG", "SMLL", "LWSLNG"]}, "CLR"=>{"label"=>"color", "values"=>{"GR"=>{"image"=>"gray.svg", "label"=>"gray"}, "RD"=>{"image"=>"red.svg", "label"=>"red"}, "WHT"=>{"image"=>"white.svg", "label"=>"white"}, "BLCK"=>{"image"=>"black.svg", "label"=>"black"}, "BRWN"=>{"image"=>"brown.svg", "label"=>"brown"}, "TNLLW"=>{"image"=>"tan-yellow.svg", "label"=>"tan/yellow"}}, "valuesOrder"=>["TNLLW", "RD", "BRWN", "WHT", "GR", "BLCK"]}, "HRNS"=>{"label"=>"Horns", "values"=>{"CRVD"=>{"image"=>"curved-icon.svg", "label"=>"curved"}, "SHPD"=>{"image"=>"u-shaped-icon.svg", "label"=>"u-shaped"}, "SPRL"=>{"image"=>"spiral-horns-icon.svg", "label"=>"spiral"}, "STRGHT"=>{"image"=>"straight-icon.svg", "label"=>"straight"}}, "valuesOrder"=>["STRGHT", "CRVD", "SPRL", "SHPD"]}, "PTTRN"=>{"label"=>"Pattern", "values"=>{"SLD"=>{"image"=>"solid-icon.svg", "label"=>"solid"}, "BNDS"=>{"image"=>"banding-icon.svg", "label"=>"bands"}, "SPTS"=>{"image"=>"spots-icon.svg", "label"=>"spots"}, "STRPS"=>{"image"=>"stripes-icon.svg", "label"=>"stripes"}}, "valuesOrder"=>["SLD", "STRPS", "BNDS", "SPTS"]}}, "characteristicsOrder"=>["LK", "PTTRN", "CLR", "HRNS", "TL", "BLD"]}, "T2"=>{"type"=>"shortcut", "answers"=>[{"label"=>"Nothing Here"}]}}
      end

      it 'should return the strings via the collect method' do
        subject.visit(survey_task_hash)
        binding.pry
        expect(subject.collector).to include(
          "T1.choices.GNT.confusions" => {"CVT"=>"A civet is stockier than a genet with a much shorter tail and a dark mask on the face."},
          "T1.choices.FR.descriptions" => "It's a fire. Pretty sure you know what this looks like."
        )
      end
    end
  end
end
